<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thy Forum</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
    }

    .navbar {
      background-color: #007bff;
      padding: 1rem;
    }

    .navbar a {
      color: white;
      margin-right: 1rem;
      text-decoration: none;
    }

    .hidden {
      display: none;
    }

    .announcement, .comment {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 1rem;
      padding: 1rem;
    }

    .form-control, .btn {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <a href="#" id="home-link">Home</a>
    <a href="#" id="stream-link">Stream</a>
    <a href="#" id="settings-link">Settings</a>
  </div>

  <div class="content">
    <h1>Thy Forum</h1>

    <!-- Authentication Section -->
    <section id="auth-section">
      <h2>Login / Register</h2>
      <input type="email" id="email" class="form-control" placeholder="Email">
      <input type="password" id="password" class="form-control" placeholder="Password">
      <button class="btn btn-primary" id="login-btn">Login</button>
      <button class="btn btn-secondary" id="register-btn">Register</button>
    </section>

    <!-- Create Class Section -->
    <section id="create-class-section" class="hidden">
      <h2>Create a Class</h2>
      <input type="text" id="class-name" class="form-control" placeholder="Class Name">
      <textarea id="class-description" class="form-control" placeholder="Class Description"></textarea>
      <input type="text" id="class-theme" class="form-control" placeholder="Class Theme (e.g., Math, Science)">
      <button class="btn btn-primary" id="create-class-btn">Create Class</button>
    </section>

    <!-- Join Class Section -->
    <section id="join-class-section" class="hidden">
      <h2>Join a Class</h2>
      <input type="text" id="class-code" class="form-control" placeholder="Class Code">
      <button class="btn btn-primary" id="join-class-btn">Join Class</button>
    </section>

    <!-- Announcements Section -->
    <section id="announcements-section" class="hidden">
      <h2>Stream</h2>
      <textarea id="announcement-input" class="form-control" placeholder="Post an announcement"></textarea>
      <button class="btn btn-success" id="post-announcement-btn">Post Announcement</button>
      <div id="announcements-list"></div>
    </section>

    <!-- Manage Class Section -->
    <section id="manage-class-section" class="hidden">
      <h2>Manage Class</h2>
      <input type="text" id="ban-email" class="form-control" placeholder="Enter Email to Ban">
      <button class="btn btn-danger" id="ban-user-btn">Ban User</button>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      onAuthStateChanged,
    } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      doc,
      setDoc,
      addDoc,
      getDocs,
      query,
      where,
      deleteDoc,
    } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAl3eqFYTgar3l97-JLX6ee6yhveqf_nVQ",
      authDomain: "thyforumm.firebaseapp.com",
      projectId: "thyforumm",
      storageBucket: "thyforumm.appspot.com",
      messagingSenderId: "23733239837",
      appId: "1:23733239837:web:be46fcbeef217414a3c6f4",
      measurementId: "G-KDRFK8B2Y2",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM Elements
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const loginBtn = document.getElementById("login-btn");
    const registerBtn = document.getElementById("register-btn");
    const createClassBtn = document.getElementById("create-class-btn");
    const joinClassBtn = document.getElementById("join-class-btn");
    const postAnnouncementBtn = document.getElementById("post-announcement-btn");
    const banUserBtn = document.getElementById("ban-user-btn");
    const classNameInput = document.getElementById("class-name");
    const classDescriptionInput = document.getElementById("class-description");
    const classThemeInput = document.getElementById("class-theme");
    const announcementInput = document.getElementById("announcement-input");
    const banEmailInput = document.getElementById("ban-email");
    const announcementsList = document.getElementById("announcements-list");

    let currentUser = null;
    let currentClass = null;

    // Authentication
    registerBtn.addEventListener("click", async () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        alert("User registered!");
      } catch (error) {
        alert(error.message);
      }
    });

    loginBtn.addEventListener("click", async () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        alert("Login successful!");
      } catch (error) {
        alert(error.message);
      }
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        document.getElementById("create-class-section").classList.remove("hidden");
        document.getElementById("join-class-section").classList.remove("hidden");
        document.getElementById("announcements-section").classList.remove("hidden");
      } else {
        currentUser = null;
      }
    });

    // Creating Classes
    createClassBtn.addEventListener("click", async () => {
      const className = classNameInput.value;
      const description = classDescriptionInput.value;
      const theme = classThemeInput.value;
      try {
        const classRef = await addDoc(collection(db, "classes"), {
          name: className,
          description,
          theme,
          creator: currentUser.uid,
        });
        currentClass = classRef.id;
        alert(`Class "${className}" created!`);
      } catch (error) {
        alert(error.message);
      }
    });

    // Joining Classes
    joinClassBtn.addEventListener("click", async () => {
      const classCode = classCodeInput.value;
      try {
        const classQuery = query(collection(db, "classes"), where("__name__", "==", classCode));
        const classDocs = await getDocs(classQuery);
        if (!classDocs.empty) {
          currentClass = classCode;
          alert("Joined class successfully!");
        } else {
          alert("Invalid class code!");
        }
      } catch (error) {
        alert(error.message);
      }
    });

    // Posting Announcements
    postAnnouncementBtn.addEventListener("click", async () => {
      const text = announcementInput.value;
      try {
        await addDoc(collection(db, "classes", currentClass, "announcements"), {
          text,
          author: currentUser.uid,
          timestamp: new Date(),
        });
        alert("Announcement posted!");
        announcementInput.value = "";
      } catch (error) {
        alert(error.message);
      }
    });

    // Ban User
    banUserBtn.addEventListener("click", async () => {
      const banEmail = banEmailInput.value;
      try {
        await setDoc(doc(db, "classes", currentClass, "bans", banEmail), { banned: true });
        alert(`${banEmail} has been banned!`);
      } catch (error) {
        alert(error.message);
      }
    });

    // Expandable Commenting and Deletion Handlers (to be added here)
  </script>
</body>
</html>
