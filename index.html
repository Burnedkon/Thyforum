<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Classroom System</title>
  <script type="module" defer>
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAl3eqFYTgar3l97-JLX6ee6yhveqf_nVQ",
  authDomain: "thyforumm.firebaseapp.com",
  databaseURL: "https://thyforumm-default-rtdb.firebaseio.com",
  projectId: "thyforumm",
  storageBucket: "thyforumm.firebasestorage.app",
  messagingSenderId: "23733239837",
  appId: "1:23733239837:web:be46fcbeef217414a3c6f4",
  measurementId: "G-KDRFK8B2Y2"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
    // DOM Elements
    const appContainer = document.getElementById("app");
    const loginPage = document.getElementById("loginPage");
    const dashboard = document.getElementById("dashboard");
    const classPage = document.getElementById("classPage");
    const createClassBtn = document.getElementById("createClassBtn");
    const classesContainer = document.getElementById("classesContainer");
    const announcementContainer = document.getElementById("announcementContainer");
    const classSidebar = document.getElementById("classSidebar");
    const logoutBtn = document.getElementById("logoutBtn");
    const classForm = document.getElementById("classForm");

    // State Management
    let currentUser = null;
    let selectedClassId = null;

    // Auth Handlers
    document.getElementById("loginBtn").addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        currentUser = userCredential.user;
        loadDashboard();
      } catch (error) {
        alert(error.message);
      }
    });

    document.getElementById("registerBtn").addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        alert("Registered successfully! Please log in.");
      } catch (error) {
        alert(error.message);
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      currentUser = null;
      toggleUI("login");
    });

    // Toggle UI
    function toggleUI(page) {
      loginPage.style.display = page === "login" ? "block" : "none";
      dashboard.style.display = page === "dashboard" ? "block" : "none";
      classPage.style.display = page === "class" ? "block" : "none";
    }

    // Load Dashboard
    async function loadDashboard() {
      toggleUI("dashboard");
      classesContainer.innerHTML = ""; // Clear previous classes
      const classesSnapshot = await getDocs(collection(db, "classes"));
      classesSnapshot.forEach(doc => {
        const classData = doc.data();
        const classCard = document.createElement("div");
        classCard.className = "class-card";
        classCard.style.backgroundColor = classData.themeColor;
        classCard.innerHTML = `<h3>${classData.name}</h3><p>${classData.description}</p>`;
        classCard.addEventListener("click", () => openClass(doc.id));
        classesContainer.appendChild(classCard);
      });
    }

    // Create Class
    createClassBtn.addEventListener("click", async () => {
      const name = prompt("Enter class name:");
      const description = prompt("Enter class description:");
      const themeColor = prompt("Enter theme color (e.g., #2196F3):");
      if (name && description && themeColor) {
        const newClass = {
          name,
          description,
          themeColor,
          creator: currentUser.uid,
          members: [currentUser.uid]
        };
        await addDoc(collection(db, "classes"), newClass);
        loadDashboard();
      }
    });

    // Open Class
    async function openClass(classId) {
      selectedClassId = classId;
      toggleUI("class");
      const classDoc = await getDoc(doc(db, "classes", classId));
      const classData = classDoc.data();
      document.getElementById("classTitle").innerText = classData.name;

      // Load Announcements
      const announcementsSnapshot = await getDocs(collection(db, "classes", classId, "announcements"));
      announcementContainer.innerHTML = ""; // Clear previous announcements
      announcementsSnapshot.forEach(doc => {
        const announcementData = doc.data();
        const announcementCard = document.createElement("div");
        announcementCard.className = "announcement-card";
        announcementCard.innerHTML = `
          <p>${announcementData.content}</p>
          <button class="deleteAnnouncementBtn">Delete</button>
        `;
        announcementCard.querySelector(".deleteAnnouncementBtn").addEventListener("click", () => deleteAnnouncement(doc.id));
        announcementContainer.appendChild(announcementCard);
      });

      // Load Members
      const membersList = document.getElementById("membersList");
      membersList.innerHTML = ""; // Clear previous members
      classData.members.forEach(member => {
        const memberItem = document.createElement("li");
        memberItem.innerText = member;
        membersList.appendChild(memberItem);
      });
    }

    // Post Announcement
    document.getElementById("postAnnouncementBtn").addEventListener("click", async () => {
      const content = document.getElementById("announcementInput").value;
      if (content) {
        await addDoc(collection(db, "classes", selectedClassId, "announcements"), {
          content,
          creator: currentUser.uid,
          timestamp: new Date()
        });
        openClass(selectedClassId); // Refresh announcements
      }
    });

    // Delete Announcement
    async function deleteAnnouncement(announcementId) {
      await deleteDoc(doc(db, "classes", selectedClassId, "announcements", announcementId));
      openClass(selectedClassId); // Refresh announcements
    }

    // Firebase Auth Listener
    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        loadDashboard();
      } else {
        toggleUI("login");
      }
    });
  </script>
  <style>
    /* Add your CSS styles here */
    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="app">
    <!-- Login Page -->
    <div id="loginPage">
      <h1>Classroom</h1>
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <button id="loginBtn">Log In</button>
      <button id="registerBtn">Register</button>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
      <h1>Your Classes</h1>
      <button id="createClassBtn">+ Create Class</button>
      <button id="logoutBtn">Logout</button>
      <div id="classesContainer"></div>
    </div>

    <!-- Class Page -->
    <div id="classPage" class="hidden">
      <h1 id="classTitle"></h1>
      <textarea id="announcementInput" placeholder="Post an announcement..."></textarea>
      <button id="postAnnouncementBtn">Post</button>
      <div id="announcementContainer"></div>
      <ul id="membersList"></ul>
    </div>
  </div>
</body>
</html>

